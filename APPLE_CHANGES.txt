This contains the changes after creating `v3.4.0`

# From 4.0.0
SPARK-44661      `getMapOutputLocation` should not throw NPE
SPARK-42730      Update Spark Standalone Mode page
SPARK-44585      Fix warning condition in MLLib RankingMetrics ndcgAk
SPARK-44623      Upgrade `commons-lang3` to 3.13.0
SPARK-44707      Use INFO log in `ExecutorPodsWatcher.onClose` if `SparkContext` is stopped
SPARK-44726      Improve `HeartbeatReceiver` config validation error message
SPARK-44741      Support regex-based MetricFilter in `StatsdSink`
SPARK-44214      Support Spark Driver Live Log UI
SPARK-44916      Document Spark Driver Live Log UI
SPARK-44936      Simplify the log when Spark HybridStore hits the memory limit
SPARK-44993      Add `ShuffleChecksumUtils.compareChecksums` by reusing `ShuffleChecksumTestHelp.compareChecksums`
SPARK-44995      Promote `SparkKubernetesClientFactory` to `DeveloperApi`
SPARK-44996      Use `lazy val` for `DefaultVolcanoClient`
SPARK-45054      HiveExternalCatalog.listPartitions should restore partition statistics

# From 3.5.0
SPARK-42396      Upgrade `Apache Kafka` to 3.4.0
SPARK-42536      Upgrade log4j2 to 2.20.0
SPARK-42718      Upgrade rocksdbjni to 7.10.2
SPARK-42761      Upgrade `kubernetes-client` to 6.5.0
SPARK-42764      Parameterize the max number of attempts for driver props fetcher in KubernetesExecutorBackend
SPARK-42769      Add `SPARK_DRIVER_POD_IP` env variable to executor pods
SPARK-42779      Allow V2 writes to indicate advisory shuffle partition size
SPARK-42794      Increase the lockAcquireTimeoutMs to 2 minutes for acquiring the RocksDB state store in Structure Streaming
SPARK-42808      Avoid getting availableProcessors every time in `MapOutputTrackerMaster#getStatistics`
SPARK-42833      Refactor `applyExtensions` in `SparkSession`
SPARK-42885      Upgrade `kubernetes-client` to 6.5.1
SPARK-43070      Upgrade `sbt-unidoc` to 0.5.0
SPARK-42382      Upgrade cyclonedx-maven-plugin to 2.7.5
SPARK-43483      Adds SQL references for OFFSET clause
SPARK-43281      Fix concurrent writer does not update file metrics
SPARK-43517      Add a migration guide for namedtuple monkey patch
SPARK-43527      Fix `catalog.listCatalogs` in PySpark
SPARK-43548      Remove workaround for HADOOP-16255
SPARK-43157      Clone InMemoryRelation cached plan to prevent cloned plan from referencing same objects
SPARK-43522      Fix creating struct column name with index of array
SPARK-43450      Add more `_metadata` filter test cases
Revert           SPARK-43313 Adding missing column DEFAULT values for MERGE INSERT actions
SPARK-43580      Add `https://dlcdn.apache.org/` to default_sites of get_preferred_mirrors
SPARK-43587      Run `HealthTrackerIntegrationSuite` in a dedicated JVM
SPARK-43842      Upgrade `gcs-connector` to 2.2.14
SPARK-36612      Support left outer join build left or right outer join build right in shuffled hash join
SPARK-44088      Remove `jdk.incubator.foreign` usage in Java 21
SPARK-44095      Make HiveExternalCatalogVersionsSuite skip old Spark versions on Java 21
SPARK-44092      Add `Utils.isJavaVersionAtLeast21` and make `core` module pass with Java 21
SPARK-44045      Mark `WholeStageCodegenSparkSubmitSuite` as `ExtendedSQLTest`
SPARK-44057      Mark all `local-cluster`-based tests as `ExtendedSQLTest`
SPARK-42369      Fix constructor for java.nio.DirectByteBuffer
SPARK-43876      Enable fast hashmap for distinct queries
SPARK-44139      Discard completely pushed down filters in group-based MERGE operations
SPARK-44138      Prohibit non-deterministic expressions, subqueries and aggregates in MERGE conditions
SPARK-43203      Move all Drop Table case to DataSource V2
SPARK-43975      DataSource V2: Handle UPDATE commands for group-based sources
SPARK-43963      DataSource V2: Handle MERGE commands for group-based sources
SPARK-44237      Simplify DirectByteBuffer constructor lookup logic
SPARK-44230      Make `sql` module passes in Java 21
SPARK-44183      Increate `PyArrow` minimum version to 4.0.0
SPARK-44153      Use JAVA_HOME and stderr
SPARK-43885      DataSource V2: Handle MERGE commands for delta-based sources
SPARK-44000      Add hint to disable broadcasting and replicating one side of join
SPARK-43959      Make RowLevelOperationSuiteBase and AlignAssignmentsSuite abstract
SPARK-43775      DataSource V2: Allow representing updates as deletes and inserts
SPARK-43324      Handle UPDATE commands for delta-based sources
SPARK-44294      Fix HeapHistogram column shows unexpectedly w/ select-all-box
SPARK-44215      If num chunks are 0, then server should throw a RuntimeException
SPARK-44313      Fix generated column expression validation when there is a char/varchar column in the schema
SPARK-44501      Ignore checksum files in KubernetesLocalDiskShuffleExecutorComponents
SPARK-44360      Support schema pruning in delta-based MERGE operations
SPARK-44392      Add tests for schema pruning in delta-basedUPDATEs
SPARK-44402      Add tests for schema pruning in delta-based DELETEs
SPARK-44534      Handle only shuffle files in KubernetesLocalDiskShuffleExecutorComponents
SPARK-44653      Non-trivial DataFrame unions should not break caching
SPARK-44588      Fix double encryption issue for migrated shuffle blocks
MINOR            Update concat and concat_ws documentation to point out unexpected behavior
SPARK-44641      Incorrect result in certain scenarios when SPJ is not triggered
MINOR            Fix incorrect link in sql menu and typo
SPARK-44990      Reduce the frequency of get `spark.sql.legacy.nullValueWrittenAsQuotedEmptyStringCsv`

# From 3.4.2
SPARK-44670      Fix 'test_dataframe_conversion.DataFrameConversionTest.get_excel_dfs' test to work with Python 3.7
SPARK-44634      Encoders.bean does no longer support nested beans with type arguments
SPARK-44657      Fix incorrect limit handling in ArrowBatchWithSchemaIterator and config parsing of CONNECT_GRPC_ARROW_MAX_BATCH_SIZE
SPARK-44725      Document `spark.network.timeoutInterval`
SPARK-44581      Fix the bug that ShutdownHookManager gets wrong UGI from SecurityManager of ApplicationMaster
SPARK-44745      Document shuffle data recovery from the remounted K8s PVCs
SPARK-44813      The Jira Python misses our assignee when it searches users again
SPARK-44875      Fix spelling for commentator to test SPARK-44813
SPARK-44857      Fix `getBaseURI` error in Spark Worker LogPage UI buttons
SPARK-44859      Fix incorrect property name in structured streaming doc
SPARK-44854      Python timedelta to DayTimeIntervalType edge case bug
SPARK-44871      Fix percentile_disc behaviour
SPARK-44922      Disable o.a.p.h.InternalParquetRecordWriter logs for tests
SPARK-44925      K8s default service token file should not be materialized into token
SPARK-44920      Use await() instead of awaitUninterruptibly() in TransportClientFactory.createClient()
SPARK-44935      Fix `RELEASE` file to have the correct information in Docker images if exists
SPARK-44929      Standardize log output for console appender in tests
SPARK-44840      Make `array_insert()` 1-based for negative indexes
SPARK-44547      Ignore fallback storage for cached RDD migration

# From 3.4.1
SPARK-43067      Correct the location of error class resource file in Kafka connector
SPARK-43075      Change gRPC to grpcio when it is not installed.
MINOR            Tests in SubquerySuite should not drop view created in `beforeAll`
SPARK-43072      Include TIMESTAMP_NTZ type in ANSI Compliance doc
SPARK-43071      Support SELECT DEFAULT with ORDER BY, LIMIT, OFFSET for INSERT source relation
SPARK-43083      Mark *StateStoreSuite as ExtendedSQLTest
SPARK-43085      Support column DEFAULT assignment for multi-part table names
SPARK-43126      Mark two Hive UDF expressions as stateful
SPARK-43125      Fix Connect Server Can't Handle Exception With Null Message
SPARK-43050      Fix construct aggregate expressions by replacing grouping functions
SPARK-43139      Fix incorrect column names in sql-ref-syntax-dml-insert-table.md
SPARK-42475      Fix PySpark connect Quickstart binder link
SPARK-43158      Set upperbound of pandas version for Binder integration
SPARK-43141      Ignore generated Java files in checkstyle
SPARK-42078      Add `CapturedException` to utils
SPARK-43113      Evaluate stream-side variables when generating code for a bound condition
SPARK-43098      Fix correctness COUNT bug when scalar subquery has group by clause
SPARK-37829      Dataframe.joinWith outer-join should return a null value for unmatched row
MINOR            Fix the doc of parameter `num` in `DataFrame.offset`
SPARK-43113      Add comment about copying steam-side variables
SPARK-43249      Fix missing stats for SQL Command
SPARK-43293      __qualified_access_only should be ignored in normal columns
SPARK-43414      Fix flakiness in Kafka RDD suites due to port binding configuration issue
SPARK-43410      Improve vectorized loop for Packed skipValues
SPARK-43342      Revert SPARK-39006 Show a directional error message for executor PVC dynamic allocation failure
SPARK-43395      Exclude macOS tar extended metadata in make-distribution.sh
SPARK-43374      Move protobuf-java to BSD 3-clause group and update the license copy
SPARK-43340      Handle missing stack-trace field in eventlogs
SPARK-43337      Asc/desc arrow icons for sorting column does not get displayed in the table column
SPARK-43284      Return URI encoded path, and add a test
SPARK-43284      back to url-encoded strings
SPARK-43378      Properly close stream objects in deserializeFromChunkedBuffer
SPARK-43313      Adding missing column DEFAULT values for MERGE INSERT actions
SPARK-43336      Casting between Timestamp and TimestampNTZ requires timezone
SPARK-43156      Fix `COUNT(*) is null` bug in correlated scalar subquery
SPARK-43425      Add TimestampNTZType to ColumnarBatchRow
SPARK-43441      makeDotNode should not fail when DeterministicLevel is absent
SPARK-43471      Handle missing hadoopProperties and metricsProperties
SPARK-43043      Improve the performance of MapOutputTracker.updateMapOutput
SPARK-43589      Fix `cannotBroadcastTableOverMaxTableBytesError` to use `bytesToString`
SPARK-42826      Update migration notes for pandas API on Spark
SPARK-43547      Update "Supported Pandas API" page to point out the proper pandas docs
SPARK-43541      Propagate all `Project` tags in resolving of expressions and missing columns
SPARK-43718      Set nullable correctly for keys in USING joins
SPARK-43719      Handle `missing row.excludedInStages` field
MINOR            Fix `SeriesDateTimeTests.test_quarter` to work properly
SPARK-43758      Upgrade snappy-java to 1.1.10.0
SPARK-43758      Update Hadoop 2 dependency manifest
SPARK-43759      Expose TimestampNTZType in pyspark.sql.types
SPARK-43751      Document `unbase64` behavior change
SPARK-43802      Fix codegen for unhex and unbase64 with failOnError=true
SPARK-42421      Use the utils to get the switch for dynamic allocation used in local checkpoint
SPARK-43894      Fix bug in df.cache()
SPARK-43760      Nullability of scalar subquery results
SPARK-43949      Upgrade cloudpickle to 2.2.1
SPARK-43956      Fix the bug doesn't display column's sql for Percentile[Cont|Disc]
SPARK-43911      Use toSet to deduplicate the iterator data to prevent the creation of large Array
Revert           SPARK-43911 Use toSet to deduplicate the iterator data to prevent the creation of large Array
SPARK-43973      Structured Streaming UI should display failed queries correctly
SPARK-43510      Fix YarnAllocator internal state when adding running executor after processing completed containers
SPARK-43976      Handle the case where modifiedConfigs doesn't exist in event logs
SPARK-43973      Fix compilation by switching QueryTerminatedEvent constructor
MINOR            Move ResolveDefaultColumnsSuite to 'o.a.s.sql'
SPARK-42290      Fix the OOM error can't be reported when AQE on
SPARK-43404      Skip reusing sst file for same version of RocksDB state store to avoid id mismatch error
SPARK-44038      Update YuniKorn docs with v1.3
SPARK-43398      Executor timeout should be max of idle shuffle and rdd timeout
SPARK-32559      Fix the trim logic did't handle ASCII control characters correctly
SPARK-44053      Update ORC to 1.8.4
SPARK-44040      Fix compute stats when AggregateExec node above QueryStageExec
SPARK-44070      Bump snappy-java 1.1.10.1
MINOR            Fix all dead links for K8s doc
SPARK-44018      Improve the hashCode and toString for some DS V2 Expression
SPARK-44134      Fix setting resources (GPU/FPGA) to 0 when they are set in spark-defaults.conf
SPARK-44142      Replace type with tpe in utility to convert python types to spark types
SPARK-44136      Fixed an issue that StateManager may get materialized in executor instead of driver in FlatMapGroupsWithStateExec
SPARK-44158      Remove unused `spark.kubernetes.executor.lostCheckmaxAttempts`
SPARK-44079      Fix `ArrayIndexOutOfBoundsException` when parse array as struct using PERMISSIVE mode with corrupt record
SPARK-44206      DataSet.selectExpr scope Session.active
SPARK-44184      Remove a wrong doc about `ARROW_PRE_0_15_IPC_FORMAT`
SPARK-44241      Mistakenly set io.connectionTimeout/connectionCreationTimeout to zero or negative will cause incessant executor cons/destructions
SPARK-42784      should still create subDir when the number of subDir in merge dir is less than conf
SPARK-44251      Set nullable correctly on coalesced join key in full outer USING join
SPARK-44180      DistributionAndOrderingUtils should apply ResolveTimeZone
SPARK-44391      Check the number of argument types in `InvokeLike`
SPARK-44415      Upgrade snappy-java to 1.1.10.2
SPARK-44464      Fix applyInPandasWithStatePythonRunner to output rows that have Null as first column value
SPARK-44494      Use `minikube` v1.30.1 for `k8s-integration-tests`
SPARK-44544      Deduplicate `run_python_packaging_tests`
SPARK-44553      Ignoring `connect-check-protos` logic in GA testing
SPARK-44479      Fix protobuf conversion from an empty struct type
SPARK-44557      Clean up untracked/ignored files before running pip packaging test in GitHub Actions
SPARK-44513      Upgrade snappy-java to 1.1.10.3
SPARK-44544      Force run `run_python_packaging_tests`

# Internal Patches
MINOR            Add rio.yml and dev scripts
MINOR            Adjust test cases for RIO
MINOR            Bump to 3.4.0.1-apple-SNAPSHOT
SPARK-17767      Support user-provided ExternalCatalog and SessionBuilder
rdar://64257964  Add back http support so it works without hadoop configuration
rdar://68926116  Add alternative conf name `spark.FsUrlStreamHandlerFactory.enabled`
rdar://66576657  Add spark-avro to the tgz build to simplify kernels
rdar://82806227  Support Apple repo in DependencyUtils for Ivy
rdar://82183532  Support CachedS3AFileSystem for S3
rdar://82423473  Support `spark.sql.files.s3c.enabled` conf
rdar://89567863  Add parquet footer cache feature in SMC
rdar://104445096 Apply internal configurations
rdar://72552554  Increase DEFAULT_MAX_CONSECUTIVE_STAGE_ATTEMPTS from 4 to 6
MINOR            Use zstd as default compression codec
MINOR            Support JarvisSparkHadoopUtil
MINOR            Use Utils.localHostName() for bindAddress
rdar://71819374  Bridge in LZO codec family
rdar://91548932  Update log4j1 dependency detection for log4j2 2.17.2
rdar://90787805  Make spark driver endpoints extensible to be used by awsappleconnect-spark-utils
rdar://103524012 Adding color from spark plan UI block depending on inner text
rdar://100580258 Upgrade Hive to 2.3.9.4-apple
rdar://70562690  Update kubernetes Dockerfile to AppleJDK
rdar://82095645  Integrate ACI spark call home service listener
MINOR            Forward port multiple containers and shuffle service from ACS 3.0
rdar://99714991  Support configuring version of the PME Key to use for writing
rdar://101964650 Enable Dependency Test
rdar://105024624 Set `spark.sql.autoBroadcastJoinThreshold` to 100MB
rdar://104835338 Add bump-version.sh (#1670)
rdar://79590736  Extend 'k8sRegex' to accept 'aci-k8s'
MINOR            Fix ExternalShuffleSidecarSuite compilation error
rdar://105590919 Use ubuntu:jammy in Dockerfile
rdar://105739324 Build PySpark Package
rdar://106124632 Enable hive profile for `connect` module test
rdar://106365381 Bump Parquet to 1.12.3.3-apple
rdar://106150608 Bump Hadoop to 3.3.4.3-apple (#1697)
rdar://106670519 Add Boson version 0.3.0 in Spark-3.4 (#1714)
rdar://107596423 Add BosonSort handling in JoinSuite (#1725)
rdar://92996732  Use quoted identifier for column name 'date' before pushing filter to UC (#1412)
rdar://107856276 Disable shuffle service sidecar feature
rdar://107970457 Bump Boson to 0.3.1 (#1733)
rdar://108296516 [Boson] handle BosonFilter in stripSparkFilter
rdar://108592695 [Boson] Bump Boson version to 0.3.2 in Spark
rdar://109188323 [Boson] Enable Boson scan in Spark 3.4 by default (#1754)
rdar://109549054 Bump Boson version to 0.3.5 (#1759)
rdar://110070310 Bump Hive version to 2.3.9.6-apple (#1766)
rdar://110133417 Bump Boson version to 0.3.9 (#1768)
rdar://110553017 [Boson] Update version to 0.3.11 (#1779)
rdar://110658365 Check whether mvn bumps versions correctly (#1782)
rdar://110874630 Bump Boson to 0.3.12 (#1795)
SPARK-44110      Propagate proxy settings to forked JVMs
SPARK-44153      Support `Heap Histogram` column in `Executors` tab
SPARK-44147      Add `spark.ui.allowFramingFrom` doc to `Security` page
rdar://99333529  (Job Insights: Tune based on cpu/mem/disk underutilization of pods)
SPARK-43204      Align MERGE assignments with table attributes
SPARK-43268      Use proper error classes when exceptions are constructed with a message
rdar://111110273 Add InMemoryStore.getData method to support internal history server
SPARK-42151      Align UPDATE assignments with table attributes
rdar://84031512  Add stored procedure API (#1801)
SPARK-43088      Respect RequiresDistributionAndOrdering in CTAS/RTAS
SPARK-42855      Use runtime null checks in TableOutputResolver
SPARK-42997      TableOutputResolver must use correct column paths in error messages for arrays and maps
SPARK-44125      Support Java 21 in SparkR
SPARK-44122      Make `connect` module pass except Arrow-related ones in Java 21
SPARK-44099      Support both java-8-openjdk-amd64 and java-8-openjdk-arm64 in `spark-rm` Dockerfile
rdar://110667736 Include CLASSES.csv file in Apple spark tarball
rdar://111235765 Create Table and Alter Table with Distribution Port to 3.4 (#1808)
rdar://111955881 Differentiate Create Table Unordered from Create Table default (#1810)
rdar://111985992 Upgrade Parquet to 1.13.1.1-apple (#1811)
rdar://112211550 Add spark-connect library to binary distribution
rdar://112203854 Update Boson version to 0.3.13 (#1815)
rdar://112293760 Add Iceberg 1.3.0.0-apple To Spark 3.4 Apple (#1818)
rdar://112293760 Bump Iceberg to 1.3.0.1-apple (#1823)
rdar://112325953 Add Rio pipeline to run iceberg unit tests for branch-3.4.0 (#1819)
rdar://112431669 Auto load Iceberg extensions (#1805)
rdar://112325953 Add Rio pipeline to run iceberg unit tests for branch-3.4.0
rdar://112620764 Add a debug log to DiskStore.moveFileToBlock (#1829)
rdar://112692714 (Bump Iceberg to 1.3.0.2-apple) (#1828)
rdar://112767815 Upgrade Parquet version to 1.13.1.2-apple for ACS Spark 3.4 (#1830)
rdar://113050231 [Boson] Bump Boson version to 0.3.14 in Spark (#1833)
rdar://113352087 Fix artifact filter for publishing images
rdar://113060247 Publish images for snapshot and release builds
rdar://113641362 Avoid artifactory redirects for snapshot distributions
rdar://110127648 Upgrade callhome service to 0.2.29
rdar://113772991 Update Boson to 0.3.15
rdar://113767905 Update Iceberg to 1.3.0.3-apple
rdar://113781872 Enable BosonShuffleManager in Spark 3.4
rdar://112799075 Async profiler support
rdar://113781872 Remove BosonConf dependency from core by using string config names
rdar://114672798 Don't load Boson jar in Spark unless Boson is enabled (#1850)
rdar://114854895 Bump Boson to 0.3.18 (#1854)
